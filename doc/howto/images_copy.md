(images-copy)=
# イメージをコピーやインポートするには

イメージをイメージストアに追加するには、他のサーバーからコピーすることもできますし、ファイル(ローカルのファイルまたはウェブサーバー上のファイル)からインポートすることもできます。

## リモートからイメージをコピーする

あるサーバーから別のサーバーにイメージをコピーするには、以下のコマンドを入力します。

    lxc image copy [<source_remote>:]<image> <target_remote>:

```{note}
イメージをローカルのイメージストアにコピーするには、コピー先のリモートに`local:`と指定します。
```

全ての利用可能なフラグの一覧は`lxc image copy --help`を参照してください。
最も重要なものは以下の通りです。

`--alias`
: イメージのコピーに割り当てるエイリアス。

`--copy-aliases`
: コピー元のイメージが持つエイリアスをコピーする。

`--auto-update`
: 元のイメージが更新されたらコピーも更新する。

`--vm`
: エイリアスからコピーする際、仮想マシンを作成するのに使えるイメージをコピーする。

## ファイルからイメージをインポートする

要求される{ref}`image-format`を使用するイメージファイルを持っていれば、イメージストアにインポートできます。

そのようなイメージファイルを取得する方法はいくつかあります。

- 既存のイメージをエクスポートする ({ref}`images-manage-export`参照)
- `distrobuilder`でイメージを生成する ({ref}`images-create-build`参照)
- [image server](https://images.linuxcontainers.org/images/)からイメージファイルをダウンロードする (イメージをファイルにダウンロードしてインポートするより、{ref}`リモートのイメージを使用する <images-remote>`ほうが通常は簡単なことに注意してください)

### ローカルファイルシステムからインポートする

ローカルファイルシステムからイメージをインポートするには、`lxc image import`コマンドを使用します。
このコマンドは{ref}`統合イメージ <image-format-unified>`(圧縮されたファイルまたはディレクトリ)と{ref}`分離イメージ <image-format-split>`(2つのファイル)の両方をサポートします。

1つのファイルまたはディレクトリから統合イメージをインポートするには、以下のコマンドを入力します。

    lxc image import <image_file_or_directory_path> [<target_remote>:]

分離イメージをインポートするには、以下のコマンドを入力します。

    lxc image import <metadata_tarball_path> <rootfs_tarball_path> [<target_remote>:]

どちらの場合も、`--alias`フラグでエイリアスを割り当てられます。
利用可能なすべてのフラグは`lxc image import --help`を参照してください。

### リモートウェブサーバーからファイルをインポートする

URLを指定してリモートウェブサーバーからイメージファイルをインポートできます。
この方法はイメージをユーザに配布するためだけにLXDサーバーを稼働させる代わりに使用できます。
必要なのはカスタムヘッダ({ref}`images-copy-http-headers`参照)をサポートする基本的なウェブサーバーだけです。

イメージファイルは統合イメージ({ref}`image-format-unified`参照)として提供される必要があります。

リモートウェブサーバーからイメージをインポートするには、以下のコマンドを入力します。

    lxc image import <URL>

`--alias`フラグでローカルのイメージにエイリアスを割り当てられます。

(images-copy-http-headers)=
#### カスタムHTTPヘッダ

LXDでは以下のカスタムHTTPヘッダをウェブサーバーで設定する必要があります。

`LXD-Image-Hash`
: ダウンロードされるイメージのSHA256ハッシュ値。

`LXD-Image-URL`
: イメージをダウンロードするURL。

LXDはサーバーに問い合わせる際に以下のヘッダを設定します。

`LXD-Server-Architectures`
: クライアントがサポートするアーキテクチャのカンマ区切りリスト。

`LXD-Server-Version`
: 使用しているLXDのバージョン
