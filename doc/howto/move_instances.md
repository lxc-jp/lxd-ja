(move-instances)=
# サーバ間で既存の LXD インスタンスを移動するには

ある LXD サーバから別のサーバへインスタンスを移動するには `lxc move` コマンドを使います。

    lxc move [<source_remote>:]<source_instance_name> <target_remote>:[<target_instance_name>]

```{note}
コンテナを移動する際にはまず停止する必要があります。
詳細は {ref}`live-migration` を参照してください。
```

移動元のリモートがデフォルトのリモートの場合は省略可能で、移動先でも同じインスタンス名を使用する場合は移動先インスタンス名は省略できます。
インスタンスを特定のクラスタメンバに移動したい場合は、`--target` フラグを指定してください。
この場合、移動元と移動先のリモートは指定を省略してください。

ネットワークのセットアップに応じて、`--mode` フラグを追加して転送モードを選択できます。

`pull` (デフォルト)
: 移動先のサーバに、移動元のサーバへ接続させ該当のインスタンスをプルするように指示します。

`push`
: 移動元のサーバに、移動先のサーバへ接続させインスタンスをプッシュするように指示します。

`relay`
: クライアントに移動元と移動先の両方に接続させデータをクライアント経由で転送するよう指示します。

移動先のサーバ上でインスタンスを動かすように設定を調整する必要がある場合、(`--config`, `--device`, `--storage`, `--target-project` を使用して) 設定を直接指定するか、(`--no-profiles` か `--profile` を使って) プロファイルを経由して指定できます。全ての利用可能なフラグについては `lxc move --help` を参照してください。

(live-migration)=
## ライブマイグレーション

仮想マシンは稼働したまま、つまり一切のダウンタイムなしで、別のサーバに移動できます。

コンテナについては、[{abbr}`CRIU (Checkpoint/Restore in Userspace)`](https://criu.org/) を使ったライブマイグレーションが限定的にサポートされています。
しかし、カーネル依存が激しいため、確実にマイグレートできるのは非常に基本的なコンテナ (ネットワークデバイスなしの `systemd` を使用しないコンテナ) のみとなっています。
ほとんどの現実のシナリオでは、コンテナを停止し、移動して、再度起動するべきです。

コンテナのライブマイグレーションを使用したい場合、移動元と移動先の両方で CRIU を有効にする必要があります。
snap を使っている場合、以下のコマンドで CRIU を有効にしてください。

    snap set lxd criu.enable=true
    systemctl reload snap.lxd.daemon

それ以外の場合、両方のシステムで CRIU がインストールされていることを確認してください。
