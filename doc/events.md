# イベント <!-- Events -->

## はじめに <!-- Introduction -->
イベントとは LXD 上で発生したアクションに関するメッセージです。 `/1.0/events` の API エンドポイントを直接使うか `lxc monitor` コマンドを使うことでウェブソケットに接続しログとライフサイクルメッセージがストリーム出力されます。
<!--
Events are messages about actions that have occurred over LXD. Using the API endpoint `/1.0/events` directly or via
`lxc monitor` will connect to a WebSocket through which logs and lifecycle messages will be streamed.
-->

## イベント種別 <!-- Event types -->
LXD は現在 3 つのイベント種別をサポートします。
<!--
LXD Currently supports three event types.
-->
- **Logging**: サーバーのログレベルに関係なく全てのログメッセージを表示します。 <!-- Shows all logging messages regardless of the server logging level. -->
- **Operation**: 作成から完了までの（状態と進捗メタデータの更新を含む）全ての実行中のオペレーションを表示します。 <!-- Shows all ongoing operations from creation to completion (including updates to their state and progress metadata). -->
- **Lifecycle**: LXD 上で発生する特定のアクションの監査証跡を表示します。 <!-- Shows an audit trail for specific actions occurring over LXD. -->

## イベント構造 <!-- Event structure -->
### 例: <!-- Example: -->
```yaml
location: cluster_name
metadata:
  action: network-updated
  requestor:
    protocol: unix
    username: root
  source: /1.0/networks/lxdbr0
timestamp: "2021-03-14T00:00:00Z"
type: lifecycle
```
- `location`: クラスターメンバー名（クラスターであれば）。 <!-- The cluster member name (if clustered). -->
- `timestamp`: RFC3339 形式のイベント発生時刻。 <!-- Time that the event occurred in RFC3339 format. -->
- `type`: イベント種別（`logging`, `operation`, `lifecycle` のいずれか）。 <!-- The type of event this is (one of `logging`, `operation`, or `lifecycle`). -->
- `metadata`: 特定のイベント種別に関する情報。 <!-- Information about the specific event type. -->

### logging イベントの構造 <!-- Logging event structure -->
- `message`: ログメッセージ。 <!-- The log message. -->
- `level`: ログのログレベル。 <!-- The log-level of the log. -->
- `context`: イベントに含まれる追加情報。 <!-- Additional information included in the event. -->

### operation イベントの構造 <!-- Operation event structure -->
- `id`: オペレーションの UUID <!-- The UUID of the operation. -->
- `class`: オペレーション種別（task, token, websocket のいずれか）。 <!-- The type of operation (task, token, or websocket). -->
- `description`: オペレーションの説明。 <!-- A description of the operation. -->
- `created_at`: オペレーションの作成日時。 <!-- The operation's creation date. -->
- `updated_at`: オペレーションの更新日時。 <!-- The operation's date of last change. -->
- `status`: オペレーションの現在の状態。 <!-- The current state of the operation. -->
- `status_code`: オペレーションのステータスコード。 <!-- The operation status code. -->
- `resources`: このオペレーションで影響を受けるリソース。 <!-- Resources affected by this operation. -->
- `metadata`: オペレーション特有のメタデータ。 <!-- Operation specific metadata. -->
- `may_cancel`: オペレーションがキャンセル可能か。 <!-- Whether the operation may be cancelled. -->
- `err`: オペレーションのエラーメッセージ。 <!-- Error message of the operation. -->
- `location`: クラスターメンバー名（クラスターであれば）。 <!-- The cluster member name (if clustered). -->

### lifecycle イベントの構造 <!-- Lifecycle event structure -->
- `action`: 発生したライフサイクルアクション。 <!-- The lifecycle action that occurred. -->
- `requestor`: 誰がリクエストを作成したかの情報（該当するものがあれば）。 <!-- Information about who is making the request (if applicable). -->
- `source`: アクションの対象のパス。 <!-- Path to what is being acted upon. -->
- `context`: イベントに含まれる追加情報。 <!-- Additional information included in the event. -->

## サポートされる lifecycle イベント <!-- Supported lifecycle events -->
| 名前 <!-- Name -->                     | 説明 <!-- Description -->                                                                                                                               | 追加情報 <!-- Additional Information -->                                                                                                                                                          | -
| :------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `certificate-created`                  | サーバーのトラスト・ストアに新しい証明書が追加された。 <!-- A new certificate has been added to the server trust store. -->                             |                                                                                                                                                                                                   |
| `certificate-deleted`                  | トラスト・ストアから証明書が削除された。 <!-- The certificate has been deleted from the trust store. -->                                                |                                                                                                                                                                                                   |
| `certificate-updated`                  | 証明書の設定が更新された。 <!-- The certificate's configuration has been updated. -->                                                                   |                                                                                                                                                                                                   |
| `cluster-certificate-updated`          | クラスター全体の証明書が変更された。 <!-- The certificate for the whole cluster has changed. -->                                                        |                                                                                                                                                                                                   |
| `cluster-disabled`                     | このマシンに対してクラスタリングが無効化された。 <!-- Clustering has been disabled for this machine. -->                                                |                                                                                                                                                                                                   |
| `cluster-enabled`                      | このマシンに対してクラスタリングが有効化された。 <!-- Clustering has been enabled for this machine. -->                                                 |                                                                                                                                                                                                   |
| `cluster-member-added`                 | 新しいマシンがクラスターに参加した。 <!-- A new machine has joined the cluster. -->                                                                     |                                                                                                                                                                                                   |
| `cluster-member-removed`               | クラスターからクラスターメンバーが削除された。 <!-- The cluster member has been removed from the cluster. -->                                           |                                                                                                                                                                                                   |
| `cluster-member-renamed`               | クラスターメンバーがリネームされた。 <!-- The cluster member has been renamed. -->                                                                      | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `cluster-member-updated`               | クラスターメンバーの設定が変更された。 <!-- The cluster member's configuration been edited. -->                                                         |                                                                                                                                                                                                   |
| `cluster-token-created`                | クラスターメンバー追加のための参加トークンが作成された。 <!-- A join token for adding a cluster member has been created. -->                            |                                                                                                                                                                                                   |
| `config-updated`                       | サーバーの設定が変更された。 <!-- The server configuration has changed. -->                                                                             |                                                                                                                                                                                                   |
| `image-alias-created`                  | 既存イメージのエイリアスが作成された。 <!-- An alias has been created for an existing image. -->                                                        | `target`: オリジナルのインスタンス。 <!-- the original instance. -->                                                                                                                              |
| `image-alias-deleted`                  | 既存イメージのエイリアスが削除された。 <!-- An alias has been deleted for an existing image. -->                                                        | `target`: オリジナルのインスタンス。 <!-- the original instance. -->                                                                                                                              |
| `image-alias-renamed`                  | 既存イメージのエイリアスがリネームされた。 <!-- The alias for an existing image has been renamed. -->                                                   | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `image-alias-updated`                  | イメージ・エイリアスの設定が変更された。 <!-- The configuration for an image alias has changed. -->                                                     | `target`: オリジナルのインスタンス。 <!-- the original instance. -->                                                                                                                              |
| `image-created`                        | イメージ・ストアに新しいイメージが追加された。 <!-- A new image has been added to the image store. -->                                                  | `type`: container か vm。 <!-- container or vm. -->                                                                                                                                               |
| `image-deleted`                        | イメージ・ストアからイメージが削除された。 <!-- The image has been deleted from the image store. -->                                                    |                                                                                                                                                                                                   |
| `image-refreshed`                      | ローカルのイメージコピーが現在のソースイメージのバージョンに更新された。 <!-- The local image copy has updated to the current source image version. --> |                                                                                                                                                                                                   |
| `image-retrieved`                      | raw イメージファイルがサーバーからダウンロードされた。 <!-- The raw image file has been downloaded from the server. -->                                 | `target`: ダウンロード先のサーバー。 <!-- destination server. -->                                                                                                                                 |
| `image-secret-created`                 | イメージ取得用のワンタイム・キーが作成された。 <!-- A one-time key to fetch this image has been created. -->                                            |                                                                                                                                                                                                   |
| `image-updated`                        | イメージの設定が変更された。 <!-- The image's configuration has changed. -->                                                                            |                                                                                                                                                                                                   |
| `instance-backup-created`              | インスタンスのバックアップが作成された。 <!-- A backup of the instance has been created. -->                                                            |                                                                                                                                                                                                   |
| `instance-backup-deleted`              | インスタンスのバックアップが削除された。 <!-- The instance backup has been deleted. -->                                                                 |                                                                                                                                                                                                   |
| `instance-backup-renamed`              | インスタンスのバックアップがリネームされた。 <!-- The instance backup has been renamed. -->                                                             | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `instance-backup-retrieved`            | raw インスタンス・バックアップ・ファイルがダウンロードされた。 <!-- The raw instance backup file has been downloaded. -->                               |                                                                                                                                                                                                   |
| `instance-console`                     | インスタンスのコンソールに接続された。 <!-- Connected to the console of the instance. -->                                                               | `type`: console か vga。 <!-- console or vga. -->                                                                                                                                                 |
| `instance-console-reset`               | コンソール・バッファーがリセットされた。 <!-- The console buffer has been reset. -->                                                                    |                                                                                                                                                                                                   |
| `instance-console-retrieved`           | コンソール・ログがダウンロードされた。 <!-- The console log has been downloaded. -->                                                                    |                                                                                                                                                                                                   |
| `instance-created`                     | 新しいインスタンスが作成された。 <!-- A new instance has been created. -->                                                                              |                                                                                                                                                                                                   |
| `instance-deleted`                     | インスタンスが削除された。 <!-- The instance has been deleted. -->                                                                                      |                                                                                                                                                                                                   |
| `instance-exec`                        | インスタンス上でコマンドが実行された。 <!-- A command has been executed on the instance. -->                                                            | `command`: 実行されたコマンド。 <!-- the command to be executed. -->                                                                                                                              |
| `instance-file-deleted`                | インスタンス上のファイルが削除された。 <!-- A file on the instance has been deleted. -->                                                                | `file`: ファイルのパス。 <!-- path to the file. -->                                                                                                                                               |
| `instance-file-pushed`                 | インスタンスにファイルがアップロードされた。 <!-- The file has been pushed to the instance. -->                                                         | `file-source`: ローカルのファイルパス。 <!--local file path. --> `file-destination`: コピー先のファイルパス。 <!-- destination file path. --> `info`: ファイルの情報。 <!-- file information. --> |
| `instance-file-retrieved`              | インスタンスからファイルがダウンロードされた。<!-- The file has been downloaded from the instance. -->                                                  | `file-source`: インスタンスのファイルパス。 <!-- instance file path. --> `file-destination`: コピー先のファイルパス。 <!-- destination file path. -->                                             |
| `instance-log-deleted`                 | インスタンスの指定のログファイルが削除された。 <!-- The instance's specified log file has been deleted. -->                                             |                                                                                                                                                                                                   |
| `instance-log-retrieved`               | インスタンスの指定のログファイルがダウンロードされた。 <!-- The instance's specified log file has been downloaded. -->                                  |                                                                                                                                                                                                   |
| `instance-metadata-retrieved`          | インスタンスのイメージメタデータがダウンロードされた。 <!-- The instance's image metadata has been downloaded. -->                                      |                                                                                                                                                                                                   |
| `instance-metadata-updated`            | インスタンスのイメージメタデータが変更された。 <!-- The instance's image metadata has changed. -->                                                      |                                                                                                                                                                                                   |
| `instance-metadata-template-created`   | インスタンスの新しいイメージテンプレートファイルが作成された。 <!-- A new image template file for the instance has been created. -->                    | `path`: ファイルの相対パス。 <!-- relative file path. -->                                                                                                                                         |
| `instance-metadata-template-deleted`   | インスタンスのイメージテンプレートファイルが削除された。 <!-- The image template file for the instance has been deleted. -->                            | `path`: ファイルの相対パス。 <!-- relative file path. -->                                                                                                                                         |
| `instance-metadata-template-retrieved` | インスタンスのイメージテンプレートファイルがダウンロードされた。 <!-- The image template file for the instance has been downloaded. -->                 | `path`: ファイルの相対パス。 <!-- relative file path. -->                                                                                                                                         |
| `instance-paused`                      | インスタンスが休止状態にされた。 <!-- The instance has been put in a paused state. -->                                                                  |                                                                                                                                                                                                   |
| `instance-renamed`                     | インスタンスがリネームされた。 <!-- The instance has been renamed. -->                                                                                  | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `instance-restarted`                   | インスタンスが再起動された。 <!-- The instance has restarted. -->                                                                                       |                                                                                                                                                                                                   |
| `instance-restored`                    | インスタンスがスナップショットから復元された。 <!-- The instance has been restored from a snapshot. -->                                                 | `snapshot`: 復元されたスナップショット名。 <!-- name of the snapshot being restored. -->                                                                                                          |
| `instance-resumed`                     | インスタンスが休止状態から復帰された。 <!-- The instance has resumed after being paused. -->                                                            |                                                                                                                                                                                                   |
| `instance-shutdown`                    | インスタンスがシャットダウンされた。 <!-- The instance has shut down. -->                                                                               |                                                                                                                                                                                                   |
| `instance-started`                     | インスタンスが起動された。 <!-- The instance has started. -->                                                                                           |                                                                                                                                                                                                   |
| `instance-stopped`                     | インスタンスが停止された。 <!-- The instance has stopped. -->                                                                                           |                                                                                                                                                                                                   |
| `instance-updated`                     | インスタンスの設定が変更された。 <!-- The instance's configuration has changed. -->                                                                     |                                                                                                                                                                                                   |
| `instance-snapshot-created`            | インスタンスのスナップショットが作成された。 <!-- A snapshot of the instance has been created. -->                                                      |                                                                                                                                                                                                   |
| `instance-snapshot-deleted`            | インスタンスのスナップショットが削除された。 <!-- The instance snapshot has been deleted. -->                                                           |                                                                                                                                                                                                   |
| `instance-snapshot-renamed`            | インスタンスのスナップショットがリネームされた。 <!-- The instance snapshot has been renamed. -->                                                       | `old_name`: 以前の名前。<!-- the previous name. -->                                                                                                                                               |
| `instance-snapshot-updated`            | インスタンス・スナップショットの設定が変更された。 <!-- The instance snapshot's configuration has changed. -->                                          |                                                                                                                                                                                                   |
| `network-acl-created`                  | 新しいネットワーク ACL が作成された。 <!-- A new network acl has been created. -->                                                                      |                                                                                                                                                                                                   |
| `network-acl-deleted`                  | ネットワーク ACL が削除された。 <!-- The network acl has been deleted. -->                                                                              |                                                                                                                                                                                                   |
| `network-acl-renamed`                  | ネットワーク ACL がリネームされた。 <!-- The network acl has been renamed. -->                                                                          | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `network-acl-updated`                  | ネットワーク ACL の設定が変更された。 <!-- The network acl configuration has changed. -->                                                               |                                                                                                                                                                                                   |
| `network-created`                      | ネットワークデバイスが作成された。 <!-- A network device has been created. -->                                                                          |                                                                                                                                                                                                   |
| `network-deleted`                      | ネットワークデバイスが削除された。 <!-- The network device has been deleted. -->                                                                        |                                                                                                                                                                                                   |
| `network-renamed`                      | ネットワークデバイスがリネームされた。 <!-- The network device has been renamed. -->                                                                    | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `network-updated`                      | ネットワークデバイスの設定が変更された。 <!-- The network device's configuration has changed. -->                                                       |                                                                                                                                                                                                   |
| `operation-cancelled`                  | オペレーションがキャンセルされた。 <!-- The operation has been cancelled. -->                                                                           |                                                                                                                                                                                                   |
| `profile-created`                      | 新しいプロファイルが作成された。 <!-- A new profile has been created. -->                                                                               |                                                                                                                                                                                                   |
| `profile-deleted`                      | プロファイルが削除された。 <!-- The profile has been deleted. -->                                                                                       |                                                                                                                                                                                                   |
| `profile-renamed`                      | プロファイルがリネームされた。 <!-- The profile has been renamed . -->                                                                                  | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `profile-updated`                      | プロファイルの設定が変更された。 <!-- The profile's configuration has changed. -->                                                                      |                                                                                                                                                                                                   |
| `project-created`                      | 新しいプロジェクトが作成された。 <!-- A new project has been created. -->                                                                               |                                                                                                                                                                                                   |
| `project-deleted`                      | プロジェクトが削除された。 <!-- The project has been deleted. -->                                                                                       |                                                                                                                                                                                                   |
| `project-renamed`                      | プロジェクトがリネームされた。 <!-- The project has been renamed. -->                                                                                   | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `project-updated`                      | プロジェクトの設定が変更された。 <!-- The project's configuration has changed. -->                                                                      |                                                                                                                                                                                                   |
| `storage-pool-created`                 | 新しいストレージプールが作成された。 <!-- A new storage pool has been created. -->                                                                      | `target`: クラスターメンバー名。 <!-- cluster member name. -->                                                                                                                                    |
| `storage-pool-deleted`                 | ストレージプールが削除された。 <!-- The storage pool has been deleted. -->                                                                              |                                                                                                                                                                                                   |
| `storage-pool-updated`                 | ストレージプールの設定が変更された。 <!-- The storage pool's configuration has changed. -->                                                             | `target`: クラスターメンバー名。 <!-- cluster member name. -->                                                                                                                                    |
| `storage-volume-backup-created`        | ストレージボリュームの新しいバックアップが作成された。 <!-- A new backup for the storage volume has been created. -->                                   | `type`: container, virtual-machine, image, custom のいずれか。 <!-- container, virtual-machine, image, or custom. -->                                                                             |
| `storage-volume-backup-deleted`        | ストレージボリュームのバックアップが削除された。 <!-- The storage volume's backup has been deleted. -->                                                 |                                                                                                                                                                                                   |
| `storage-volume-backup-renamed`        | ストレージボリュームのバックアップがリネームされた。 <!-- The storage volume's backup has been renamed. -->                                             | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `storage-volume-backup-retrieved`      | ストレージボリュームのバックアップがダウンロードされた。 <!-- The storage volume's backup has been downloaded. -->                                      |                                                                                                                                                                                                   |
| `storage-volume-created`               | 新しいストレージボリュームが作成された。 <!-- A new storage volume has been created. -->                                                                | `type`: container, virtual-machine, image, custom のいずれか。 <!-- container, virtual-machine, image, or custom. -->                                                                             |
| `storage-volume-deleted`               | ストレージボリュームが削除された。 <!-- The storage volume has been deleted. -->                                                                        |                                                                                                                                                                                                   |
| `storage-volume-renamed`               | ストレージボリュームがリネームされた。 <!-- The storage volume has been renamed. -->                                                                    | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `storage-volume-restored`              | ストレージボリュームがスナップショットから復元された。 <!-- The storage volume has been restored from a snapshot. -->                                   | `snapshot`: 復元されたスナップショット名。 <!-- name of the snapshot being restored. -->                                                                                                          |
| `storage-volume-updated`               | ストレージボリュームの設定が変更された。 <!-- The storage volume's configuration has changed. -->                                                       |                                                                                                                                                                                                   |
| `storage-volume-snapshot-created`      | 新しいストレージボリュームスナップショットが作成された。 <!-- A new storage volume snapshot has been created. -->                                       | `type`: container, virtual-machine, image, custom のいずれか。 <!-- container, virtual-machine, image, or custom. -->                                                                             |
| `storage-volume-snapshot-deleted`      | ストレージボリュームのスナップショットが削除された。 <!-- The storage volume's snapshot has been deleted. -->                                           |                                                                                                                                                                                                   |
| `storage-volume-snapshot-renamed`      | ストレージボリュームのスナップショットがリネームされた。 <!-- The storage volume's snapshot has been renamed. -->                                       | `old_name`: 以前の名前。 <!-- the previous name. -->                                                                                                                                              |
| `storage-volume-snapshot-updated`      | ストレージボリュームのスナップショットの設定が変更された。 <!-- The configuration for the storage volume's snapshot has changed. -->                    |                                                                                                                                                                                                   |
| `warning-acknowledged`                 | 警告の状態が "acknowledged" （確認済み）に設定された。 <!-- The warning's status has been set to "acknowledged". -->                                    |                                                                                                                                                                                                   |
| `warning-deleted`                      | 警告が削除された。 <!-- The warning has been deleted. -->                                                                                               |                                                                                                                                                                                                   |
| `warning-reset`                        | 警告の状態が "new" （新規）に設定された。 <!-- The warning's status has been set to "new". -->                                                          |                                                                                                                                                                                                   |
