# ネットワークフォワード設定

ネットワークフォワードは外部 IP アドレス（あるいは外部 IP アドレスの特定のポート）をフォワード設定が属するネットワーク内の内部 IP アドレス（あるいは内部 IP アドレスの特定のポート）にフォワードする機能です。

各フォワード設定には単一の外部リッスンアドレスが必要で、オプショナルでデフォルトのターゲットアドレス（これによりポート指定にマッチしないトラフィックをそのアドレスにフォワードします）と複数のポート指定（これによりリッスンアドレス上の特定のポートをデフォルトのターゲットアドレスとは異なるアドレス上の指定のポートにフォワードします）を指定できます。

全てのターゲットアドレスはフォワード設定が関連付けられるネットワークと同じサブネット内でなければなりません。

デフォルトのターゲットアドレスはフォワードの `config` セットの `target_address` フィールドで指定されます。

指定可能なリッスンアドレスはフォワード設定が関連付けられる [ネットワーク種別](#network-types) によって異なります。

## プロパティ
ネットワークフォワードのプロパティには以下のものがあります。

プロパティ | 型 | 必須 | 説明
:--              | :--        | :--      | :--
listen\_address  | string     | yes      | リッスンする IP アドレス
description      | string     | no       | ネットワークフォワードの説明
config           | string set | no       | 設定のキーバリューペア（`target_address` と `user.*` カスタムキーのみサポート）
ports            | port list  | no       | ネットワークフォワードのポートリスト

ネットワークフォワードポートのプロパティには以下のものがあります。

プロパティ | 型 | 必須 | 説明
:--               | :--        | :--      | :--
protocol          | string     | yes      | ポートのプロトコル (`tcp` or `udp`)
listen\_port      | string     | yes      | リッスンするポート (例 `80,90-100`)
target\_address   | string     | yes      | フォワード先の IP アドレス
target\_port      | string     | no       | ターゲットのポート (例 `70,80-90` or `90`)、 空の場合は `listen_port` と同じ
description       | string     | no       | ポートの説明

## ネットワーク種別

以下のネットワーク種別がフォワードをサポートします。詳細は各ネットワーク種別の項を参照してください。

 - [bridge](#network-bridge)
 - [ovn](#network-ovn)


### ブリッジ

衝突しない任意のリッスンアドレスを指定可能です。

使用するリッスンアドレスは他のネットワークで使用中のサブネットとオーバーラップはできません。

### ovn

使用可能なリッスンアドレスはアップリンクのネットワークの `ipv{n}.routes` 設定と（設定されていれば）プロジェクトの `restricted.networks.subnets` 設定で定義されているアドレスです。

使用するリッスンアドレスは他のネットワークで使用中のサブネットとオーバーラップはできません。
