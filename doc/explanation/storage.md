# ストレージプールとストレージボリュームについて
LXD はストレージプールとストレージボリュームの作成をサポートします。
次のストレージドライバが利用できます。

- {ref}`storage-dir`
- {ref}`storage-ceph`
- {ref}`storage-cephfs`
- {ref}`storage-btrfs`
- {ref}`storage-lvm`
- {ref}`storage-zfs`

## ストレージボリュームのコンテントタイプ
ストレージボリュームは `filesystem` か `block` のタイプにできます。

コンテナとコンテナイメージは常に `filesystem` になります。
仮想マシンと仮想マシンイメージは常に `block` になります。

カスタムストレージボリュームはどちらのタイプも使えてデフォルトは `filesystem` です。
`block` タイプのカスタムストレージボリュームは仮想マシンのみにアタッチできます。

ブロックカスタムストレージボリュームは以下のコマンドで作成できます。

```bash
lxc storage volume create [<remote>]:<pool> <name> --type=block
```

## LXD のデータをどこに保管するか
使用されるストレージバックエンドに応じて、 LXD はファイルシステムをホストと共有するかデータを別にしておくことができます。

### ホストと共有
これが通常もっとも空間効率よく LXD を動かす方法であり、さらに管理もおそらくいちばん楽です。
これは以下のドライバで可能です。

 - `dir` バックエンド。裏のファイルシステムは何でも良い
 - `btrfs` バックエンド。ホストが Btrfs で LXD 専用のサブボリュームを使用する場合
 - `zfs` バックエンド。ホストが ZFS で zpool 上で LXD 専用のデータセットを使用する場合

### 専用のディスクまたはパーティション
このモードでは LXD のストレージはホストから完全に独立したものになります。
メインディスク上に LXD で使用する空のパーティションを用意するかディスク全体を LXD 専用で使用することで可能です。

これは `dir`, `ceph` と `cephfs` を除く全てのストレージドライバでサポートされます。

### ループディスク
上記のどちらの選択肢も利用できない場合、 LXD はメインドライブ上にループファイルを作成して指定したストレージドライバでそれを使用できます。

これはディスクまたはパーティションを使用する機能と似ていますが、代わりにメインドライブ上の大きなファイルを使用します。
これは書き込みの都度ストレージドライバそしてメインドライブのファイルシステムを経由するためパフォーマンスのペナルティを伴います。
ループファイルは通常縮小できません。
ループファイルは指定した限界サイズまで拡大していきますが、インスタンスやイメージを削除しても縮小しません。

## デフォルトストレージプール
LXD にはデフォルトストレージプールという概念はありません。
代わりにインスタンスのルートに使用されるプールが LXD の "disk" デバイスとして扱われます。

デバイスのエントリは以下のようになります。

```yaml
  root:
    type: disk
    path: /
    pool: default
```

そしてこれはインスタンスに ("lxc launch" と "lxc init" の `--storage` オプションにて) 直接設定もできますし、 LXD のプロファイルによって設定もできます。

後者の選択肢では ("lxd init" による) LXD のデフォルトのセットアップが行ってくれます。
同じことを手動で ("default" プロファイルに対して) 行うには以下のようにします。

```bash
lxc profile device add default root disk path=/ pool=default
```
